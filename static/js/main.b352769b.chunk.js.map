{"version":3,"sources":["Form.js","Canvas.js","Wiki.js","index.js"],"names":["Form","props","onSubmit","Search","className","type","name","placeholder","onClick","setOptionSafari","Canvas","canvasRef","useRef","useEffect","animationFrameId","context","current","getContext","cancel","window","cancelAnimationFrame","render","ctx","img","Image","crossOrigin","src","w","h","drawImage","imageData","getImageData","data","len","length","palette","color","option","r","Math","floor","g","b","a","c","parseInt","calculateQuantError","o","n","oc","nc","i","oldColor","newColor","qe","e","console","log","putImageData","draw","requestAnimationFrame","setTimeout","id","width","height","ref","fetch","require","Wiki","useState","image","setImage","title","setTitle","setWidth","setHeight","setOption","optionSafari","checkBrowser","event","nativeEvent","submitter","preventDefault","searchTerm","target","elements","value","uriTerm","encodeURIComponent","url_search","response","json","parsed","encodedTitle","templateSmall","templateLarge","imageResponseSmall","imageParsedSmall","imageResponseLarge","imageParsedLarge","query","pages","hasOwnProperty","thumbnail","source","original","href","download","document","getElementById","toDataURL","replace","setAttribute","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.b352769b.chunk.js","sourcesContent":["import React from \"react\";\n\nconst Form = props => (\n\t<form onSubmit={props.Search}>\n\t\t<div className=\"search-form\">\n\t\t<input type=\"text\" className=\"Textbox\" name=\"searchTerm\" placeholder=\"show me a...\"/>\n\t\t<button name=\"bw\" onClick={() => props.setOptionSafari(\"bw\")} className=\"bw-button\">Dither in b &amp; w</button>\n\t\t<button name=\"color\" onClick={() => props.setOptionSafari(\"color\")} className=\"color-button\">Dither in color</button>\n\t\t</div>\n\t</form>\n);\n\nexport default Form;","import React, { useRef, useEffect } from 'react'\n\nconst Canvas = props => {\n\n    const canvasRef = useRef(null)\n    \n    const draw = (ctx) => {\n\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.src = props.src;\n      const w = props.w;\n      const h = props.h; \n      img.crossOrigin = 'anonymous';\n      ctx.drawImage(img, 0, 0, w, h);\n      const imageData = ctx.getImageData(0, 0, w, h);\n      const data = imageData.data;\n      const len = data.length;\n\n      const palette = (color) => {\n        if (props.option === 'color'){\n          let color_r = Math.floor((color.r / 32)) << 6;\n          let color_g = Math.floor((color.g / 32)) << 6;\n          let color_b = Math.floor((color.b / 32)) << 6;\n          return { r: color_r, g: color_g, b: color_b, a: 255 };\n        } else {\n          let c = parseInt(((color.r + color.g + color.b) / 3) > 128 ? 255 : 0);\n          return { r: c, g: c, b: c, a: 255 }; \n        }\n      }\n            \n      const calculateQuantError = (o, n) => {\n          let oc = parseInt((o.r + o.g + o.b) / 3),\n              nc = parseInt((n.r + n.g + n.b) / 3);\n          return { r: oc - nc, g: oc - nc, b: oc - nc, a: 255 };\n      }\n      \n      for(let i = 0; i < len; i+=4) {\n          let oldColor = {\n                  r: data[i+0],\n                  g: data[i+1],\n                  b: data[i+2],\n                  a: data[i+3]\n          };\n          let newColor = palette(oldColor);\n          data[i+0] = newColor.r;\n          data[i+1] = newColor.g;\n          data[i+2] = newColor.b;\n          data[i+3] = newColor.a;\n          let qe = calculateQuantError(oldColor, newColor);\n\n          try {\n              data[i+0+4] += 7/16 * qe.r;\n              data[i+1+4] += 7/16 * qe.g;\n              data[i+2+4] += 7/16 * qe.b;\n              data[i+3+4] += 7/16 * qe.a;\n          } catch(e) {console.log(e)}\n          try {\n              data[i+0-4+w*4] += 3/16 * qe.r;\n              data[i+1-4+w*4] += 3/16 * qe.g;\n              data[i+2-4+w*4] += 3/16 * qe.b;\n              data[i+3-4+w*4] += 3/16 * qe.a;\n          } catch(e) {console.log(e)}\n          try {\n              data[i+0+w*4] += 5/16 * qe.r;\n              data[i+1+w*4] += 5/16 * qe.g;\n              data[i+2+w*4] += 5/16 * qe.b;\n              data[i+3+w*4] += 5/16 * qe.a;\n          } catch(e) {console.log(e)}\n          try {\n              data[i+0+4+w*4] += 1/16 * qe.r;\n              data[i+1+4+w*4] += 1/16 * qe.g;\n              data[i+2+4+w*4] += 1/16 * qe.b;\n              data[i+3+4+w*4] += 1/16 * qe.a;\n          } catch(e) {console.log(e)}\n          }\n          ctx.putImageData(imageData, 0, 0);  \n    }\n  \n  useEffect(() => {\n    let timeout = 2000;\n    const canvas = canvasRef.current;\n    const context = canvas.getContext('2d');\n    let animationFrameId;\n    const cancel = () => {\n      window.cancelAnimationFrame(animationFrameId)\n    }\n    const render = () => {\n      draw(context)\n      animationFrameId = window.requestAnimationFrame(render)\n      //console.log(\"frame: \" + animationFrameId)\n      setTimeout(cancel, timeout)\n    }\n    render()\n    return () => {\n      window.cancelAnimationFrame(animationFrameId)\n    }\n  }, [props])\n\n  return (\n    <canvas id=\"ditherCanvas\" width={props.w} height={props.h} ref={canvasRef} {...props}/>\n  ) \n}\n\nexport default Canvas","import React, { useState , useRef, useEffect} from 'react';\nimport Form from './Form';\nimport Canvas from './Canvas';\nconst fetch = require(\"node-fetch\");\n\n\nconst Wiki = () => {\n\n  const [image, setImage] = useState(\"https://upload.wikimedia.org/wikipedia/commons/1/10/Tursiops_truncatus_01.jpg\");\n  const [title, setTitle] = useState(\"Dolphin dithered\");\n  const [width, setWidth] = useState(300);\n  const [height, setHeight] = useState(210);\n  const [option, setOption] = useState(\"color\");\n  const [optionSafari, setOptionSafari] = useState(\"color\");\n\n  const checkBrowser = (event) => {\n  /*safari has no support for nativeEvent.submitter right now, so defaults to optionSafari state taken at form button click. temporary fix, not ideal because the timing for setOptionSafari is not synced with image change and there is a delay when switching between different color options. but it works.*/\n    if (!event.nativeEvent.submitter){\n      setOption(optionSafari);\n    } else {\n      setOption(event.nativeEvent.submitter.name)\n    }\n  }\n   \n  const Search = async (e) => {\n\n    e.preventDefault();\n    const searchTerm = e.target.elements.searchTerm.value;\n    console.log(e.submitter)\n    if (!searchTerm){\n      return;\n    };\n    const uriTerm = encodeURIComponent(searchTerm)\n    const url_search = `https://en.wikipedia.org/w/api.php?origin=*&action=opensearch&search=${uriTerm}&format=json`;\n    const response = await fetch(url_search);\n    const parsed = await response.json();\n    const pageTitle = parsed[1][0];\n    const encodedTitle = encodeURIComponent(parsed[1][0]);\n    const templateSmall = `https://en.wikipedia.org/w/api.php?origin=*&action=query&format=json&formatversion=2&prop=pageimages&piprop=thumbnail&pithumbsize=600&titles=${encodedTitle}`;\n    const templateLarge = `https://en.wikipedia.org/w/api.php?origin=*&action=query&format=json&formatversion=2&prop=pageimages%7Cpageterms&titles=${encodedTitle}&pilimit=3&piprop=original&pilicense=any&wbptterms=description&redirects=`;\n    \n    const imageResponseSmall = await fetch(templateSmall);\n    const imageParsedSmall = await imageResponseSmall.json();\n    const imageResponseLarge = await fetch(templateLarge);\n    const imageParsedLarge = await imageResponseLarge.json();\n  \n    if (imageParsedSmall.query.pages[0].hasOwnProperty('thumbnail')){\n        console.log(\"thumbnail found: \" + imageParsedSmall.query.pages[0]);\n        const w = imageParsedSmall.query.pages[0].thumbnail.width;\n        const h = imageParsedSmall.query.pages[0].thumbnail.height;\n        setImage(imageParsedSmall.query.pages[0].thumbnail.source);\n        setWidth(300);\n        setHeight(Math.floor((300/w)*h));\n        setTitle(imageParsedSmall.query.pages[0].title + \" dithered\");\n        checkBrowser(e);\n    } else if (imageParsedLarge.query.pages[0].hasOwnProperty('original')) {\n        console.log(\"original used: \" + imageParsedLarge.query.pages[0]);\n        const w = imageParsedLarge.query.pages[0].original.width;\n        const h = imageParsedLarge.query.pages[0].original.height;\n        setImage(imageParsedLarge.query.pages[0].original.source);\n        setWidth(300);\n        setHeight(Math.floor((300/w)*h));\n        setTitle(imageParsedLarge.query.pages[0].title + \" dithered\");\n        checkBrowser(e)\n    } else {\n      setTitle('image not found!');\n      return;\n    };\n  }; \n\n\n\n  const download = () => {\n    let download = document.getElementById(\"download\");\n    let image = document.getElementById(\"wiki_dither\")\n                .toDataURL(\"image/png\")\n                .replace(\"image/png\", \"image/octet-stream\");\n    download.setAttribute(\"href\", image);\n  }\n\n  return (\n    <div className=\"container\">\n      <div className=\"Box\">\n        <h3>WikiDither</h3>\n        <p>search something on Wikipedia (the free encyclopedia) and see \n        its page image dithered using the <a href=\"https://en.wikipedia.org/wiki/Floyd%E2%80%93Steinberg_dithering\">\n        Floyd-Steinberg Dithering Algorithm</a>.</p>\n        <Form Search={Search} setOptionSafari={setOptionSafari}/>\n        &nbsp;\n        <Canvas className=\"dithered-image\" id=\"wiki_dither\" src={image} w={width} h={height} option={option}/>\n        <div className=\"caption-grid\">\n          <p className=\"caption\">{title}</p>\n          <a className=\"download-container\" id=\"download\" download=\"dithered_image.png\">\n            <button type=\"button\" className=\"download-button\" onClick={() => download()}>Download ↴</button>\n          </a>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Wiki;\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './App.css';\n\nimport Wiki from './Wiki';\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <Wiki />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n\n"],"sourceRoot":""}